name: CI Linting Tasks

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  lint:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        php-version: ['8.4']

    name: PHP ${{ matrix.php-version }} Static Analysis

    steps:
      - name: â¬‡ï¸ Checkout Code
        uses: actions/checkout@v5

      - name: Install Task
        uses: go-task/setup-task@v1

      - name: ğŸ› ï¸ Setup PHP ${{ matrix.php-version }} & Composer
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-version }}
          extensions: mbstring, intl, pcre, tokenizer, xml
          ini-values: error_reporting=E_ALL
          tools: composer:v2

      - name: ğŸ“¦ Install All Dependencies (Composer)
        run: task install

      - name: ğŸ” 1. Run PHPLint (Basic Syntax Check)
        run: task phplint

      - name: ğŸ”¨ 2. Run Rector (Check for Code Optimization)
        run: task rector -- --dry-run --ansi

      - name: ğŸ§¼ 3. Run PHP-CS-Fixer (Check Code Style)
        run: task phpcs -- --dry-run

      - name: ğŸ§ª 4. Run PHPUnit (Unit Tests)
        run: task phpunit

      - name: ğŸ”¬ 5. Run PHPStan (Static Analysis)
        run: task phpstan
