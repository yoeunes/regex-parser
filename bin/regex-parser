<?php

require __DIR__.'/../vendor/autoload.php';

use RegexParser\Parser\Parser;
use RegexParser\Visitor\CompilerVisitor;
use RegexParser\Visitor\ValidatorVisitor;
use RegexParser\Exception\LexerException;
use RegexParser\Exception\ParserException;
use RegexParser\Lexer\Lexer;

if ($argc < 2) {
    echo "Usage: php bin/regex-parser '/your_regex_here/'\n";
    exit(1);
}

$regex = $argv[1];

try {
    // Injection de dÃ©pendance
    $lexer = new Lexer($regex);
    $parser = new Parser($lexer);

    $ast = $parser->parse($regex);

    // Valide
    $validator = new ValidatorVisitor();
    $ast->accept($validator);

    // Recompile
    $compiler = new CompilerVisitor();
    $compiled = $ast->accept($compiler);

    echo "Parsed successfully!\n";
    echo "Recompiled: $compiled\n";

    // Bonus: Simple AST dump
    var_dump($ast);
} catch (LexerException|ParserException $e) {
    echo 'Error: '.$e->getMessage()."\n";
    exit(1);
}
