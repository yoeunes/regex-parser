#!/usr/bin/env bash
set -euo pipefail

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
BOX_BIN=""

if [ -x "${ROOT}/vendor/bin/box" ]; then
  BOX_BIN="${ROOT}/vendor/bin/box"
elif command -v box >/dev/null 2>&1; then
  BOX_BIN="$(command -v box)"
fi

if [ -z "${BOX_BIN}" ]; then
  echo "box is not installed. Install humbug/box or download box.phar."
  echo "https://github.com/box-project/box"
  exit 1
fi

mkdir -p "${ROOT}/bin"
php -d phar.readonly=0 "${BOX_BIN}" compile -c "${ROOT}/box.json"
echo "Phar built at ${ROOT}/bin/regex.phar"
